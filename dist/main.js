!function(e){var t={};function n(r){if(t[r])return t[r].exports;var u=t[r]={i:r,l:!1,exports:{}};return e[r].call(u.exports,u,u.exports,n),u.l=!0,u.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var u in e)n.d(r,u,function(t){return e[t]}.bind(null,u));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t){e.exports=require("express")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){return e&&e.__esModule?e:{default:e}}(n(14)).default.config(),t.default={port:9001,gwHost:"https://api.guildwars2.com/v2",firebaseCredentials:{type:"service_account",project_id:"gw2tracker-7d853",private_key_id:"b95095b2f7e753860e26b9293a5641ca347764fc",private_key:"-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDB/WU+vH5Bbccf\n/+HjhasA6Ymm7oLqPz6GKZNyuF7mY6LN6qYRGLvCS82bpZrU7XoDKk7zaKvcSOO9\nlfWoXMm+0sAX/QskahY1lpQ/hCx1c1um+TpWxzah2hrwovbumWc7VzL0y43cz1yt\nps8lJUmtSEOqyOdhkG8QdXXZCOn5M1ikqC4ZCMbXCX5l2Z5dbuiRtH8KP3oyxb5f\nzPbb5J1cirmkkNAGi+Q9uLSnbo/ax7bWbkDbPCSpX9jZNMsEEq7g3M3L+1yQ67Bq\nI+pAmWhrwZNa7vKZ3ergAuU4wdKhnj42dJdigYyom5nnK64uvtDSSt3WUd4SDWDu\nxidfdS7JAgMBAAECggEAC4QR5xQEgLjWGdG0ZK/SM3cpq0W8ctB3UzqTnLtSMuYW\nS5gS7K/lsYaTeZpuoxZH6Hkx/6Qmk6imEGKfFzQO6+uR6LqmVy6PC/ZY7Z5Yj05e\nUf64ll80II6Ui9V4yDhGFxE5nquYy9NpgouE/4UDpyxDjBdqGPIcjcMTUGOFlDv8\nISUIS9kgFkhrEDB7SPiBLLrkLTbCtFPv4nBIchtEDJIs5KrbDLwg4lq/BVgdsKgD\nExVDvLl4iXB4BP4dUFl86J/KrxVKnHrTlgArGu2WMLrNsxe9/QAfORAgczmXn4Sh\n/7vvrUKS4kft3iPhyb5wXOjvGtBlnfTQAhD1oIVrAQKBgQDgP6TBribY4TZ0Xysu\nGMmyRxCyh7s9osJdwTmwbMtGe2k/IgE315Z4MvhRPojvf4Z1R/aZdApdg98wB+GQ\nKcaPE7VBPrDMbYbgRYD2neOSTCu/26ABinigYRdPZkICNAleR7/JFjGWW4N6B6Ky\nx0uR5gVDsHJr0XLI86Lt0PnLwQKBgQDddPWkW0KHtgeXdXzkT9htx48tIdNeNs9p\nzpD6zXofc9pZhV++HKd4+RuyIpRLMRAexjYxhVFYaKcGOaTvWRwKFF8IO9SzObRc\nzgZ4HsQbhd+xWm45jqXtFCJ2cd4EzHM/x+NEdt6LSO2baRv0OTW26+xf5b/VU219\nPaHH60JFCQKBgGOcAZxCtmDKET059N1CB33YUVNsNUDYpkutA+oZOWYydXqkqTPb\n4Ku9wE2eYIc590jrUV+yitQlOqOELK6zz85IK9Ayf6ge0rWWSgXB9o9KpHhRn05v\n6ssatZcATjvaT3sAlfFFmXs3ZTx0XdHZ8vh420fI/dpkq/8VMf8/P2ZBAoGBANSX\nD6xskwx2eQkzluYRpEGWfeKkgyUBVtFKpDCvihmhfK3NdGCrXzWpZaX2vgcEnWX9\nf07AnZtSM2ytb6D5GQqwDZ542TIIJhWlDd7IIhgNxvSZTBDi2HQjjQXJP4m5vrUu\nrQQvXGm3Y6l6GIS1WtQz3OEeS658/TFqNeEV/bMJAoGALu94ohM6VsvVrJKGjYK+\nIIofU+PuxlWCwC0QsmvYRFlG4qhSemt6yPPkcmOKgI7TYGHLZ4nj5qxXZex1t6Xm\ndBVocGS77EZkCT+17uGjfzig0omLv7NxV/UCeb8wI1PkcTz4KKAd8+EdU81BkZ3Z\nqfd2+UK0eeT7tzmGGC4ApM4=\n-----END PRIVATE KEY-----",client_email:"firebase-adminsdk-zyxme@gw2tracker-7d853.iam.gserviceaccount.com",client_id:"107912537039751293537",auth_uri:"https://accounts.google.com/o/oauth2/auth",token_uri:"https://accounts.google.com/o/oauth2/token",auth_provider_x509_cert_url:"https://www.googleapis.com/oauth2/v1/certs",client_x509_cert_url:"https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-zyxme%40gw2tracker-7d853.iam.gserviceaccount.com"}}},function(e,t){e.exports=require("node-fetch")},function(e,t){e.exports=require("lodash/fp")},function(e,t){e.exports=require("firebase-admin")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.db=void 0;var r=a(n(16)),u=n(3),i=a(n(7)),o=n(6);function a(e){return e&&e.__esModule?e:{default:e}}var s=(0,i.default)("Gw2:NeDB:");t.db=new function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currencies=function(e){return t.execute(t.db.currency,o.getCurrencies,e)},this.items=function(e){return t.execute(t.db.items,o.getItems,e)},this.dyes=function(e){return t.execute(t.db.dyes,o.getDyes,e)},this.skins=function(e){return t.execute(t.db.skins,o.getSkins,e)},this.specializations=function(e){return t.execute(t.db.specializations,o.getSpecializations,e)},this.execute=function(e,t,n){return new Promise(function(r){var i=(0,u.compact)((0,u.uniq)(n));e.find({id:{$in:i}},function(n,o){if(n)return s(n),r(o);if(i.length===o.length)return r(o);var a=(0,u.difference)(i)(o.map(function(e){return e.id}));s("fetching ids for",a),t(a).then(function(t){404===t.status?(s(t),r(o)):e.insert(t,function(e){if(e)return r(o);r(o.concat(t))})})})})},this.db={currency:new r.default({filename:"./db/currency",autoload:!0}),items:new r.default({filename:"./db/items",autoload:!0}),dyes:new r.default({filename:"./db/dyes",autoload:!0}),skins:new r.default({filename:"./db/skins",autoload:!0}),specializations:new r.default({filename:"./db/specializations",autoload:!0})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getApiKey=t.checkToken=t.getCurrencies=t.getSpecializations=t.getGuild=t.getDyes=t.getSkins=t.getItems=void 0;var r=s(n(2)),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(4)),i=n(3),o=s(n(7)),a=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(e){if(!e.ok)throw e;return e.json()},f=function(e,t){return function(n){t(n),e(n)}};t.getItems=function e(t){return new Promise(function(n){t.length>200?Promise.all((0,i.chunk)(200)(t).map(e)).then(function(e){return n((0,i.flatten)(e))}):(0,r.default)(a.default.gwHost+"/items?ids="+t).then(c).then(n).catch(f(n,(0,o.default)("Gw2:API-items:")))})},t.getSkins=function e(t){return new Promise(function(n){t.length>200?Promise.all((0,i.chunk)(200)(t).map(e)).then(function(e){return n((0,i.flatten)(e))}):(0,r.default)(a.default.gwHost+"/skins?ids="+t).then(c).then(n).catch(f(n,(0,o.default)("Gw2:API-skins:")))})},t.getDyes=function e(t){return new Promise(function(n){t.length>200?Promise.all((0,i.chunk)(200)(t).map(e)).then(function(e){return n((0,i.flatten)(e))}):(0,r.default)(a.default.gwHost+"/colors?ids="+t).then(c).then(n).catch(f(n,(0,o.default)("Gw2:API-skins:")))})},t.getGuild=function(e){return new Promise(function(t){e?(0,r.default)(a.default.gwHost+"/guild/"+e).then(c).then(t).catch(f(t,(0,o.default)("Gw2:API-guild:"))):t(null)})},t.getSpecializations=function(e){return new Promise(function(t){(0,r.default)(a.default.gwHost+"/specializations?ids="+e).then(c).then(function(e){(function(e){return new Promise(function(t){(0,r.default)(a.default.gwHost+"/traits?ids="+e).then(c).then(t).catch(f(t,(0,o.default)("Gw2:API-traits:")))})})((0,i.flatMap)(function(e){return(0,i.concat)((0,i.get)("minor_traits")(e),(0,i.get)("major_traits")(e))})(e)).then(function(n){var r=(0,i.keyBy)("id")(n),u=(0,i.map)(function(e){var t={};return e.minor_traits.map(function(e){return t[e]=r[e]}),e.major_traits.map(function(e){return t[e]=r[e]}),(0,i.assign)(e,{traitData:t})})(e);t(u)})}).catch(f(t,(0,o.default)("Gw2:API-specializations:")))})},t.getCurrencies=function(e){return new Promise(function(t){(0,r.default)(a.default.gwHost+"/currencies?ids="+e).then(c).then(t).catch(f(t,(0,o.default)("Gw2:API-currencies:")))})},t.checkToken=function(e,t,n){var r=e.body.token||e.query.token;u.auth().verifyIdToken(r).then(function(t){e.uid=t.uid,n()}).catch(function(){t.sendStatus(500)})},t.getApiKey=function(e,t,n){u.database().ref("users/"+e.uid).once("value").then(function(r){var u=r.val();u&&u.apiKey?(e.apiKey=u.apiKey,n()):t.status(403).send({message:"No Api Key"})})}},function(e,t){e.exports=require("debug")},function(e,t,n){e.exports=n(9)},function(e,t,n){"use strict";(0,function(e){return e&&e.__esModule?e:{default:e}}(n(10)).default)()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(0)),u=s(n(11)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(4)),o=s(n(12)),a=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}var c=(0,r.default)();t.default=function(){i.initializeApp({credential:i.credential.cert(a.default.firebaseCredentials),databaseURL:"https://gw2tracker-7d853.firebaseio.com/"}),c.use(u.default.urlencoded({extended:!1})),c.use(u.default.json()),c.use("/api",o.default),c.listen(a.default.port,function(){console.log("Express router listening on port: "+a.default.port)})}},function(e,t){e.exports=require("body-parser")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(0)),u=d(n(13)),i=d(n(17)),o=d(n(18)),a=d(n(19)),s=d(n(21)),c=d(n(22)),f=n(6);function d(e){return e&&e.__esModule?e:{default:e}}var l=r.default.Router();l.use(function(e,t,n){t.set("Cache-Control","no-store, must-revalidate, no-cache"),t.set("Pragma","no-cache"),t.set("Access-Control-Allow-Origin","*"),t.set("Access-Control-Allow-Methods","GET, POST"),n()}).use(f.checkToken).use("/tokeninfo",i.default).use(f.getApiKey).use("/characters",u.default).use("/permissions",o.default).use("/account/wallet",a.default).use("/account/skins",s.default).use("/account/dyes",c.default),t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(0)),u=f(n(2)),i=n(3),o=f(n(1)),a=n(6),s=n(15),c=n(5);function f(e){return e&&e.__esModule?e:{default:e}}function d(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var l=r.default.Router(),p=function(e){if(!e.ok)throw e.status;return e.json()};l.get("/",function(e,t){(0,u.default)(o.default.gwHost+"/characters",{headers:{Authorization:"Bearer "+e.apiKey}}).then(p).then(function(e){return t.send({body:e})}).catch(function(e){return console.error(e),t.send(e)})}).get("/:id",function(e,t){(0,u.default)(o.default.gwHost+"/characters"+e.url,{headers:{Authorization:"Bearer "+e.apiKey}}).then(p).then(function(e){var n=(0,i.flatMap)(function(e){var t=e.id,n=e.infusions,r=void 0===n?[]:n,u=e.upgrades,i=void 0===u?[]:u;return[t].concat(d(r),d(i))})(e.equipment),r=(0,i.flatMap)(function(e){var t=e.id,n=e.inventory;return[t].concat(d(n.map(function(e){return e&&e.id})))})(e.bags),u=(0,i.map)((0,i.get)("skin"))(e.equipment),o=(0,i.flatMap)((0,i.map)((0,i.get)("id")))(e.specializations);return Promise.all([c.db.items([].concat(n,r)),c.db.skins(u),(0,a.getGuild)(e.guild),c.db.specializations(o)]).then((0,s.parseData)(e)).then(function(e){return t.send({body:e})})}).catch(function(e){console.error(e),t.send(e)})}),t.default=l},function(e,t){e.exports=require("dotenv")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseData=void 0;var r=n(3);function u(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}t.parseData=function(e){return function(t){return Promise.all([i(e,[t[0],t[1]]),o(t[2]),a(e.specializations,t[3])]).then(function(t){return(0,r.assignAll)([e].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t)))})}};var i=function(e,t){return new Promise(function(n){var i=(0,r.keyBy)("id")(t[0]),o=(0,r.keyBy)("id")(t[1]),a=(0,r.flatMap)(function(e){var t=e.infusions,n=void 0===t?[]:t,a=e.upgrades,s=void 0===a?[]:a,c=e.skin,f=void 0===c?null:c,d=u(e,["infusions","upgrades","skin"]);return(0,r.assign)(d,{data:i[d.id],infusions:n.map(function(e){return i[e]}),upgrades:s.map(function(e){return i[e]}),skin:o[f]})})(e.equipment),s=(0,r.flatMap)(function(e){var t=e.inventory,n=void 0===t?[]:t,o=u(e,["inventory"]);return(0,r.assign)(o,{data:i[o.id],inventory:n.map(function(e){return e&&(0,r.assign)(e,{data:i[e.id]})})})})(e.bags);n({equipment:(0,r.keyBy)("slot")(a),bags:s})})},o=function(e){return new Promise(function(t){return t({guild:e||{name:"Not in a Guild"}})})},a=function(e,t){return new Promise(function(n){var u=(0,r.keyBy)("id")(t);n({specializations:(0,r.mapValues)((0,r.map)(function(e){return e?(0,r.assign)(e,{data:u[e.id]}):null}))(e)})})}},function(e,t){e.exports=require("nedb")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(0)),u=a(n(2)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(4)),o=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=r.default.Router(),c=function(e){if(!e.ok)throw e.status;return e.json()};s.post("/",function(e,t){(0,u.default)(o.default.gwHost+"/tokeninfo",{headers:{Authorization:"Bearer "+e.apiKey}}).then(c).then(function(n){return"OK"!==n.statusText?t.status(403).send(n.data):(i.database().ref("users/"+e.uid).set({apiKey:e.body.apiKey,permissions:n.data.permissions}),t.send({permissions:n.data.permissions}))}).catch(function(e){return console.error(e)})}),t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(4));var i=r.default.Router();i.get("/",function(e,t){u.database().ref("users/"+e.uid).once("value").then(function(e){t.send({body:e.val().permissions})})}),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(0)),u=s(n(2)),i=s(n(1)),o=n(20),a=n(5);function s(e){return e&&e.__esModule?e:{default:e}}var c=r.default.Router(),f=function(e){if(!e.ok)throw e.status;return e.json()};c.get("/",function(e,t){(0,u.default)(i.default.gwHost+"/account/wallet",{headers:{Authorization:"Bearer "+e.apiKey}}).then(f).then(function(e){var n=e.map(function(e){return e.id});a.db.currencies(n).then(function(t){return(0,o.mergeIds)(e,t)}).then(function(e){return t.send({body:e})})}).catch(function(e){return console.error(e)})}),t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeIds=void 0;var r=n(3);t.mergeIds=function(e,t){return new Promise(function(n){var u=(0,r.keyBy)("id")(t);n((0,r.map)(function(e){return(0,r.assign)(e,{data:u[e.id]})})(e))})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(0)),u=a(n(2)),i=a(n(1)),o=n(5);function a(e){return e&&e.__esModule?e:{default:e}}var s=r.default.Router(),c=function(e){if(!e.ok)throw e.status;return e.json()};s.get("/",function(e,t){(0,u.default)(i.default.gwHost+"/account/skins",{headers:{Authorization:"Bearer "+e.apiKey}}).then(c).then(function(e){o.db.skins(e).then(function(e){return t.send({body:e})})}).catch(function(e){return console.error(e)})}),t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeIds=void 0;var r=s(n(0)),u=s(n(2)),i=n(3),o=s(n(1)),a=n(5);function s(e){return e&&e.__esModule?e:{default:e}}var c=r.default.Router(),f=function(e){if(!e.ok)throw e.status;return e.json()},d=t.mergeIds=function(e,t){return new Promise(function(n){var r=(0,i.keyBy)("id")(t);n((0,i.map)(function(e){return(0,i.assign)(e,{data:r[e.item]})})(e))})};c.get("/",function(e,t){(0,u.default)(o.default.gwHost+"/account/dyes",{headers:{Authorization:"Bearer "+e.apiKey}}).then(f).then(function(e){a.db.dyes(e).then(function(e){return a.db.items(e.map(function(e){return e.item})).then(function(t){return d(e,t)})}).then(function(e){return t.send({body:e})})}).catch(function(e){return console.error(e)})}),t.default=c}]);