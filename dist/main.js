!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t){e.exports=require("express")},function(e,t){e.exports=require("lodash/fp")},function(e,t,n){n(14).config(),e.exports={port:9001,gwHost:"https://api.guildwars2.com/v2",firebaseCredentials:{type:"service_account",project_id:"gw2tracker-7d853",private_key_id:"b95095b2f7e753860e26b9293a5641ca347764fc",private_key:"-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDB/WU+vH5Bbccf\n/+HjhasA6Ymm7oLqPz6GKZNyuF7mY6LN6qYRGLvCS82bpZrU7XoDKk7zaKvcSOO9\nlfWoXMm+0sAX/QskahY1lpQ/hCx1c1um+TpWxzah2hrwovbumWc7VzL0y43cz1yt\nps8lJUmtSEOqyOdhkG8QdXXZCOn5M1ikqC4ZCMbXCX5l2Z5dbuiRtH8KP3oyxb5f\nzPbb5J1cirmkkNAGi+Q9uLSnbo/ax7bWbkDbPCSpX9jZNMsEEq7g3M3L+1yQ67Bq\nI+pAmWhrwZNa7vKZ3ergAuU4wdKhnj42dJdigYyom5nnK64uvtDSSt3WUd4SDWDu\nxidfdS7JAgMBAAECggEAC4QR5xQEgLjWGdG0ZK/SM3cpq0W8ctB3UzqTnLtSMuYW\nS5gS7K/lsYaTeZpuoxZH6Hkx/6Qmk6imEGKfFzQO6+uR6LqmVy6PC/ZY7Z5Yj05e\nUf64ll80II6Ui9V4yDhGFxE5nquYy9NpgouE/4UDpyxDjBdqGPIcjcMTUGOFlDv8\nISUIS9kgFkhrEDB7SPiBLLrkLTbCtFPv4nBIchtEDJIs5KrbDLwg4lq/BVgdsKgD\nExVDvLl4iXB4BP4dUFl86J/KrxVKnHrTlgArGu2WMLrNsxe9/QAfORAgczmXn4Sh\n/7vvrUKS4kft3iPhyb5wXOjvGtBlnfTQAhD1oIVrAQKBgQDgP6TBribY4TZ0Xysu\nGMmyRxCyh7s9osJdwTmwbMtGe2k/IgE315Z4MvhRPojvf4Z1R/aZdApdg98wB+GQ\nKcaPE7VBPrDMbYbgRYD2neOSTCu/26ABinigYRdPZkICNAleR7/JFjGWW4N6B6Ky\nx0uR5gVDsHJr0XLI86Lt0PnLwQKBgQDddPWkW0KHtgeXdXzkT9htx48tIdNeNs9p\nzpD6zXofc9pZhV++HKd4+RuyIpRLMRAexjYxhVFYaKcGOaTvWRwKFF8IO9SzObRc\nzgZ4HsQbhd+xWm45jqXtFCJ2cd4EzHM/x+NEdt6LSO2baRv0OTW26+xf5b/VU219\nPaHH60JFCQKBgGOcAZxCtmDKET059N1CB33YUVNsNUDYpkutA+oZOWYydXqkqTPb\n4Ku9wE2eYIc590jrUV+yitQlOqOELK6zz85IK9Ayf6ge0rWWSgXB9o9KpHhRn05v\n6ssatZcATjvaT3sAlfFFmXs3ZTx0XdHZ8vh420fI/dpkq/8VMf8/P2ZBAoGBANSX\nD6xskwx2eQkzluYRpEGWfeKkgyUBVtFKpDCvihmhfK3NdGCrXzWpZaX2vgcEnWX9\nf07AnZtSM2ytb6D5GQqwDZ542TIIJhWlDd7IIhgNxvSZTBDi2HQjjQXJP4m5vrUu\nrQQvXGm3Y6l6GIS1WtQz3OEeS658/TFqNeEV/bMJAoGALu94ohM6VsvVrJKGjYK+\nIIofU+PuxlWCwC0QsmvYRFlG4qhSemt6yPPkcmOKgI7TYGHLZ4nj5qxXZex1t6Xm\ndBVocGS77EZkCT+17uGjfzig0omLv7NxV/UCeb8wI1PkcTz4KKAd8+EdU81BkZ3Z\nqfd2+UK0eeT7tzmGGC4ApM4=\n-----END PRIVATE KEY-----",client_email:"firebase-adminsdk-zyxme@gw2tracker-7d853.iam.gserviceaccount.com",client_id:"107912537039751293537",auth_uri:"https://accounts.google.com/o/oauth2/auth",token_uri:"https://accounts.google.com/o/oauth2/token",auth_provider_x509_cert_url:"https://www.googleapis.com/oauth2/v1/certs",client_x509_cert_url:"https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-zyxme%40gw2tracker-7d853.iam.gserviceaccount.com"}}},function(e,t){e.exports=require("node-fetch")},function(e,t,n){const s=n(16),{difference:i,uniq:o,compact:r}=n(1),a=n(7),{getItems:c,getDyes:u,getSkins:d,getSpecializations:h,getCurrencies:l,getTitles:p,getAchievements:m}=n(6),g=a("Gw2:NeDB:");e.exports=new class{constructor(){this.db={achievements:new s({filename:"./db/achievements",autoload:!0}),currency:new s({filename:"./db/currency",autoload:!0}),dyes:new s({filename:"./db/dyes",autoload:!0}),items:new s({filename:"./db/items",autoload:!0}),skins:new s({filename:"./db/skins",autoload:!0}),specializations:new s({filename:"./db/specializations",autoload:!0}),titles:new s({filename:"./db/titles",autoload:!0})}}query(e,t,n){return new Promise(s=>{const a=r(o(n));e.find({id:{$in:a}},(n,o)=>{if(n)return g(n),s(o);if(a.length===o.length)return s(o.filter(e=>!e.blacklist));const r=i(a)(o.map(e=>e.id));g("fetching ids for",r),t(r).then(t=>{if(404===t.status){g(t);const n=r.map(e=>({id:e,blacklist:!0}));e.insert(n,e=>{if(e)return s(o);s(o)})}else e.insert(t,e=>{if(e)return s(o);s(o.concat(t))})})})})}achievements(e){return this.query(this.db.achievements,m,e)}currencies(e){return this.query(this.db.currency,l,e)}dyes(e){return this.query(this.db.dyes,u,e)}items(e){return this.query(this.db.items,c,e)}skins(e){return this.query(this.db.skins,d,e)}specializations(e){return this.query(this.db.specializations,h,e)}titles(e){return this.query(this.db.titles,p,e)}}},function(e,t){e.exports=require("firebase-admin")},function(e,t,n){const s=n(3),i=n(5),{assign:o,map:r,flatMap:a,get:c,concat:u,keyBy:d,chunk:h,flatten:l}=n(1),p=n(7),m=n(2),g=e=>{if(!e.ok)throw e;return e.json()},f=(e,t)=>n=>{t(n),e(n)},y=e=>new Promise(t=>{e.length>200?Promise.all(h(200)(e).map(y)).then(e=>t(l(e))):s(`${m.gwHost}/items?ids=${e}`).then(g).then(t).catch(f(t,p("Gw2:API-items:")))}),w=e=>new Promise(t=>{e.length>200?Promise.all(h(200)(e).map(w)).then(e=>t(l(e))):s(`${m.gwHost}/skins?ids=${e}`).then(g).then(t).catch(f(t,p("Gw2:API-skins:")))}),b=e=>new Promise(t=>{e.length>200?Promise.all(h(200)(e).map(b)).then(e=>t(l(e))):s(`${m.gwHost}/colors?ids=${e}`).then(g).then(t).catch(f(t,p("Gw2:API-dyes:")))}),k=e=>new Promise(t=>{e.length>200?Promise.all(h(200)(e).map(k)).then(e=>t(l(e))):s(`${m.gwHost}/titles?ids=${e}`).then(g).then(t).catch(f(t,p("Gw2:API-titles:")))});e.exports={getItems:y,getSkins:w,getDyes:b,getTitles:k,getAchievements:e=>new Promise(t=>{e.length>200?Promise.all(h(200)(e).map(w)).then(e=>t(l(e))):s(`${m.gwHost}/achievements?ids=${e}`).then(g).then(t).catch(f(t,p("Gw2:API-achievements:")))}),getGuild:e=>new Promise(t=>{e?s(`${m.gwHost}/guild/${e}`).then(g).then(t).catch(f(t,p("Gw2:API-guild:"))):t(null)}),getSpecializations:e=>new Promise(t=>{s(`${m.gwHost}/specializations?ids=${e}`).then(g).then(e=>{(e=>new Promise(t=>{s(`${m.gwHost}/traits?ids=${e}`).then(g).then(t).catch(f(t,p("Gw2:API-traits:")))}))(a(e=>u(c("minor_traits")(e),c("major_traits")(e)))(e)).then(n=>{const s=d("id")(n),i=r(e=>{const t={};return e.minor_traits.map(e=>t[e]=s[e]),e.major_traits.map(e=>t[e]=s[e]),o(e,{traitData:t})})(e);t(i)})}).catch(f(t,p("Gw2:API-specializations:")))}),getCurrencies:e=>new Promise(t=>{s(`${m.gwHost}/currencies?ids=${e}`).then(g).then(t).catch(f(t,p("Gw2:API-currencies:")))}),checkToken:(e,t,n)=>{const s=e.body.token||e.query.token;i.auth().verifyIdToken(s).then(t=>{e.uid=t.uid,n()}).catch(()=>{t.sendStatus(500)})},getApiKey:(e,t,n)=>{i.database().ref(`users/${e.uid}`).once("value").then(s=>{const i=s.val();i&&i.apiKey?(e.apiKey=i.apiKey,n()):t.status(403).send({message:"No Api Key"})})}}},function(e,t){e.exports=require("debug")},function(e,t,n){e.exports=n(9)},function(e,t,n){n(10)()},function(e,t,n){const s=n(0),i=n(11),o=n(5),r=n(12),a=n(2),c=s();e.exports=(()=>{o.initializeApp({credential:o.credential.cert(a.firebaseCredentials),databaseURL:"https://gw2tracker-7d853.firebaseio.com/"}),c.use(i.urlencoded({extended:!1})),c.use(i.json()),c.use("/api",r),c.listen(a.port,()=>{console.log(`Express router listening on port: ${a.port}`)})})},function(e,t){e.exports=require("body-parser")},function(e,t,n){const s=n(0),i=n(13),o=n(17),r=n(18),a=n(19),c=n(21),u=n(22),d=n(23),{checkToken:h,getApiKey:l}=n(6),p=s.Router();p.use(function(e,t,n){t.set("Cache-Control","no-store, must-revalidate, no-cache"),t.set("Pragma","no-cache"),t.set("Access-Control-Allow-Origin","*"),t.set("Access-Control-Allow-Methods","GET, POST"),n()}).use(h).use("/tokeninfo",o).use(l).use("/characters",i).use("/permissions",r).use("/account/wallet",a).use("/account/skins",c).use("/account/dyes",u).use("/account/titles",d),e.exports=p},function(e,t,n){const s=n(0),i=n(3),{map:o,flatMap:r,get:a}=n(1),c=n(2),{getGuild:u}=n(6),{parseData:d}=n(15),h=n(4),l=s.Router(),p=e=>{if(!e.ok)throw e.status;return e.json()};l.get("/",function(e,t){i(`${c.gwHost}/characters`,{headers:{Authorization:`Bearer ${e.apiKey}`}}).then(p).then(e=>t.send({body:e})).catch(e=>(console.error(e),t.send(e)))}).get("/:id",function(e,t){i(`${c.gwHost}/characters${e.url}`,{headers:{Authorization:`Bearer ${e.apiKey}`}}).then(p).then(e=>{const n=r(({id:e,infusions:t=[],upgrades:n=[]})=>[e,...t,...n])(e.equipment),s=r(({id:e,inventory:t})=>[e,...t.map(e=>e&&e.id)])(e.bags),i=o(a("skin"))(e.equipment),c=r(o(a("id")))(e.specializations);return Promise.all([h.items([].concat(n,s)),h.skins(i),u(e.guild),h.specializations(c)]).then(d(e)).then(e=>t.send({body:e}))}).catch(e=>{console.error(e),t.send(e)})}),e.exports=l},function(e,t){e.exports=require("dotenv")},function(e,t,n){const{keyBy:s,assign:i,assignAll:o,flatMap:r,map:a,mapValues:c}=n(1),u=(e,t)=>new Promise(n=>{const o=s("id")(t[0]),a=s("id")(t[1]),c=r(({infusions:e=[],upgrades:t=[],skin:n=null,...s})=>i(s,{data:o[s.id],infusions:e.map(e=>o[e]),upgrades:t.map(e=>o[e]),skin:a[n]}))(e.equipment),u=r(({inventory:e=[],...t})=>i(t,{data:o[t.id],inventory:e.map(e=>e&&i(e,{data:o[e.id]}))}))(e.bags);n({equipment:s("slot")(c),bags:u})}),d=e=>new Promise(t=>t({guild:e||{name:"Not in a Guild"}})),h=(e,t)=>new Promise(n=>{const o=s("id")(t);n({specializations:c(a(e=>e?i(e,{data:o[e.id]}):null))(e)})});e.exports={parseData:e=>t=>Promise.all([u(e,[t[0],t[1]]),d(t[2]),h(e.specializations,t[3])]).then(t=>o([e,...t]))}},function(e,t){e.exports=require("nedb")},function(e,t,n){const s=n(0),i=n(3),o=n(5),r=n(2),a=s.Router();function c(e){if(!e.ok)throw e.status;return e.json()}a.post("/",function(e,t){i(`${r.gwHost}/tokeninfo`,{headers:{Authorization:`Bearer ${e.apiKey}`}}).then(c).then(n=>"OK"!==n.statusText?t.status(403).send(n.data):(o.database().ref(`users/${e.uid}`).set({apiKey:e.body.apiKey,permissions:n.data.permissions}),t.send({permissions:n.data.permissions}))).catch(e=>console.error(e))}),e.exports=a},function(e,t,n){const s=n(0),i=n(5),o=s.Router();o.get("/",function(e,t){i.database().ref(`users/${e.uid}`).once("value").then(e=>{t.send({body:e.val().permissions})})}),e.exports=o},function(e,t,n){const s=n(0),i=n(3),o=n(2),{mergeIds:r}=n(20),a=n(4),c=s.Router(),u=e=>{if(!e.ok)throw e.status;return e.json()};c.get("/",function(e,t){i(`${o.gwHost}/account/wallet`,{headers:{Authorization:`Bearer ${e.apiKey}`}}).then(u).then(e=>{const n=e.map(e=>e.id);a.currencies(n).then(t=>r(e,t)).then(e=>t.send({body:e}))}).catch(e=>console.error(e))}),e.exports=c},function(e,t,n){const{keyBy:s,map:i,assign:o}=n(1);e.exports={mergeIds:(e,t)=>new Promise(n=>{const r=s("id")(t);n(i(e=>o(e,{data:r[e.id]}))(e))})}},function(e,t,n){const s=n(0),i=n(3),o=n(2),r=n(4),a=s.Router(),c=e=>{if(!e.ok)throw e.status;return e.json()};a.get("/",function(e,t){i(`${o.gwHost}/account/skins`,{headers:{Authorization:`Bearer ${e.apiKey}`}}).then(c).then(e=>{r.skins(e).then(e=>t.send({body:e}))}).catch(e=>console.error(e))}),e.exports=a},function(e,t,n){const s=n(0),i=n(3),{keyBy:o,map:r,assign:a}=n(1),c=n(2),u=n(4),d=s.Router(),h=e=>{if(!e.ok)throw e.status;return e.json()},l=(e,t)=>new Promise(n=>{const s=o("id")(t);n(r(e=>a(e,{data:s[e.item]}))(e))});d.get("/",function(e,t){i(`${c.gwHost}/account/dyes`,{headers:{Authorization:`Bearer ${e.apiKey}`}}).then(h).then(e=>{u.dyes(e).then(e=>u.items(e.map(e=>e.item)).then(t=>l(e,t))).then(e=>t.send({body:e}))}).catch(e=>console.error(e))}),e.exports=d},function(e,t,n){const s=n(0),i=n(3),{flatMap:o}=n(1),r=n(2),a=n(4),{mergeIds:c}=n(24),u=s.Router(),d=e=>{if(!e.ok)throw e.status;return e.json()};u.get("/",function(e,t){i(`${r.gwHost}/account/titles`,{headers:{Authorization:`Bearer ${e.apiKey}`}}).then(d).then(e=>{a.titles(e).then(e=>a.achievements(o(e=>e.achievements)(e)).then(t=>c(e,t))).then(e=>t.send({body:e}))}).catch(e=>console.error(e))}),e.exports=u},function(e,t,n){const{keyBy:s,map:i,assign:o}=n(1);e.exports={mergeIds:(e,t)=>new Promise(n=>{const r=s("id")(t);n(i(e=>o(e,{achievements:i(e=>r[e])(e.achievements)}))(e))})}}]);