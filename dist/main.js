!function(e){var t={};function n(r){if(t[r])return t[r].exports;var u=t[r]={i:r,l:!1,exports:{}};return e[r].call(u.exports,u,u.exports,n),u.l=!0,u.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var u in e)n.d(r,u,function(t){return e[t]}.bind(null,u));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=17)}([function(e,t){e.exports=require("express")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){return e&&e.__esModule?e:{default:e}}(n(11)).default.config(),t.default={port:9001,gwHost:"https://api.guildwars2.com/v2",firebaseCredentials:{type:"service_account",project_id:"gw2tracker-7d853",private_key_id:"b95095b2f7e753860e26b9293a5641ca347764fc",private_key:"-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDB/WU+vH5Bbccf\n/+HjhasA6Ymm7oLqPz6GKZNyuF7mY6LN6qYRGLvCS82bpZrU7XoDKk7zaKvcSOO9\nlfWoXMm+0sAX/QskahY1lpQ/hCx1c1um+TpWxzah2hrwovbumWc7VzL0y43cz1yt\nps8lJUmtSEOqyOdhkG8QdXXZCOn5M1ikqC4ZCMbXCX5l2Z5dbuiRtH8KP3oyxb5f\nzPbb5J1cirmkkNAGi+Q9uLSnbo/ax7bWbkDbPCSpX9jZNMsEEq7g3M3L+1yQ67Bq\nI+pAmWhrwZNa7vKZ3ergAuU4wdKhnj42dJdigYyom5nnK64uvtDSSt3WUd4SDWDu\nxidfdS7JAgMBAAECggEAC4QR5xQEgLjWGdG0ZK/SM3cpq0W8ctB3UzqTnLtSMuYW\nS5gS7K/lsYaTeZpuoxZH6Hkx/6Qmk6imEGKfFzQO6+uR6LqmVy6PC/ZY7Z5Yj05e\nUf64ll80II6Ui9V4yDhGFxE5nquYy9NpgouE/4UDpyxDjBdqGPIcjcMTUGOFlDv8\nISUIS9kgFkhrEDB7SPiBLLrkLTbCtFPv4nBIchtEDJIs5KrbDLwg4lq/BVgdsKgD\nExVDvLl4iXB4BP4dUFl86J/KrxVKnHrTlgArGu2WMLrNsxe9/QAfORAgczmXn4Sh\n/7vvrUKS4kft3iPhyb5wXOjvGtBlnfTQAhD1oIVrAQKBgQDgP6TBribY4TZ0Xysu\nGMmyRxCyh7s9osJdwTmwbMtGe2k/IgE315Z4MvhRPojvf4Z1R/aZdApdg98wB+GQ\nKcaPE7VBPrDMbYbgRYD2neOSTCu/26ABinigYRdPZkICNAleR7/JFjGWW4N6B6Ky\nx0uR5gVDsHJr0XLI86Lt0PnLwQKBgQDddPWkW0KHtgeXdXzkT9htx48tIdNeNs9p\nzpD6zXofc9pZhV++HKd4+RuyIpRLMRAexjYxhVFYaKcGOaTvWRwKFF8IO9SzObRc\nzgZ4HsQbhd+xWm45jqXtFCJ2cd4EzHM/x+NEdt6LSO2baRv0OTW26+xf5b/VU219\nPaHH60JFCQKBgGOcAZxCtmDKET059N1CB33YUVNsNUDYpkutA+oZOWYydXqkqTPb\n4Ku9wE2eYIc590jrUV+yitQlOqOELK6zz85IK9Ayf6ge0rWWSgXB9o9KpHhRn05v\n6ssatZcATjvaT3sAlfFFmXs3ZTx0XdHZ8vh420fI/dpkq/8VMf8/P2ZBAoGBANSX\nD6xskwx2eQkzluYRpEGWfeKkgyUBVtFKpDCvihmhfK3NdGCrXzWpZaX2vgcEnWX9\nf07AnZtSM2ytb6D5GQqwDZ542TIIJhWlDd7IIhgNxvSZTBDi2HQjjQXJP4m5vrUu\nrQQvXGm3Y6l6GIS1WtQz3OEeS658/TFqNeEV/bMJAoGALu94ohM6VsvVrJKGjYK+\nIIofU+PuxlWCwC0QsmvYRFlG4qhSemt6yPPkcmOKgI7TYGHLZ4nj5qxXZex1t6Xm\ndBVocGS77EZkCT+17uGjfzig0omLv7NxV/UCeb8wI1PkcTz4KKAd8+EdU81BkZ3Z\nqfd2+UK0eeT7tzmGGC4ApM4=\n-----END PRIVATE KEY-----",client_email:"firebase-adminsdk-zyxme@gw2tracker-7d853.iam.gserviceaccount.com",client_id:"107912537039751293537",auth_uri:"https://accounts.google.com/o/oauth2/auth",token_uri:"https://accounts.google.com/o/oauth2/token",auth_provider_x509_cert_url:"https://www.googleapis.com/oauth2/v1/certs",client_x509_cert_url:"https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-zyxme%40gw2tracker-7d853.iam.gserviceaccount.com"}}},function(e,t){e.exports=require("lodash/fp")},function(e,t){e.exports=require("unirest")},function(e,t){e.exports=require("firebase-admin")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getApiKey=t.checkToken=t.getCurrencies=t.getSpecializations=t.getGuild=t.getSkins=t.getItems=void 0;var r=a(n(3)),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(4)),o=n(2),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}t.getItems=function(e){return new Promise(function(t){r.default.get(i.default.gwHost+"/items?ids="+e).end(t)})},t.getSkins=function(e){return new Promise(function(t){r.default.get(i.default.gwHost+"/skins?ids="+e).end(t)})},t.getGuild=function(e){return new Promise(function(t){r.default.get(i.default.gwHost+"/guild/"+e).end(t)})},t.getSpecializations=function(e){return new Promise(function(t){r.default.get(i.default.gwHost+"/specializations?ids="+e).end(function(e){var n=(0,o.flatMap)(function(e){return(0,o.concat)((0,o.get)("minor_traits")(e),(0,o.get)("major_traits")(e))})(e.body);r.default.get(i.default.gwHost+"/traits?ids="+n).end(function(n){var r=(0,o.keyBy)("id")(n.body),u=(0,o.map)(function(e){var t={};return e.minor_traits.map(function(e){return t[e]=r[e]}),e.major_traits.map(function(e){return t[e]=r[e]}),(0,o.assign)(e,{traitData:t})})(e.body);t(u)})})})},t.getCurrencies=function(e){return new Promise(function(t){r.default.get(i.default.gwHost+"/currencies?ids="+e).end(t)})},t.checkToken=function(e,t,n){var r=e.body.token||e.query.token;u.auth().verifyIdToken(r).then(function(t){e.uid=t.uid,n()}).catch(function(){t.sendStatus(500)})},t.getApiKey=function(e,t,n){u.database().ref("users/"+e.uid).once("value").then(function(r){var u=r.val();u&&u.apiKey?(e.apiKey=u.apiKey,n()):t.status(403).send({message:"No Api Key"})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeIds=void 0;var r=n(2);t.mergeIds=function(e,t){return new Promise(function(n){var u=(0,r.keyBy)("id")(t);n((0,r.map)(function(e){return(0,r.assign)(e,{data:u[e.id]})})(e))})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(0)),u=s(n(3)),o=s(n(1)),i=n(5),a=n(6);function s(e){return e&&e.__esModule?e:{default:e}}var d=r.default.Router();d.get("/",function(e,t){u.default.get(o.default.gwHost+"/account/wallet").headers({Authorization:"Bearer "+e.apiKey}).end(function(e){if(!e.ok)return t.status(403).send(e.body);var n=e.body.map(function(e){return e.id});(0,i.getCurrencies)(n).then(function(t){return(0,a.mergeIds)(e.body,t.body)}).then(function(n){return t.send({body:n,statusCode:e.statusCode})})})}),t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(4));var o=r.default.Router();o.get("/",function(e,t){u.database().ref("users/"+e.uid).once("value").then(function(e){t.send({body:e.val().permissions})})}),t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(0)),u=a(n(3)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(4)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=r.default.Router();s.post("/",function(e,t){u.default.get(i.default.gwHost+"/tokeninfo").headers({Authorization:"Bearer "+e.body.apiKey}).end(function(n){n.ok?(o.database().ref("users/"+e.uid).set({apiKey:e.body.apiKey,permissions:n.body.permissions}),t.send({permissions:n.body.permissions})):t.status(403).send(n.body)})}),t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseData=void 0;var r=n(2);t.parseData=function(e){return function(t){return Promise.all([u(e.equipment,[t[0].body,t[1].body]),o(t[2].body),i(e.specializations,t[3])]).then(function(t){return(0,r.assignAll)([e].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t)))})}};var u=function(e,t){return new Promise(function(n){var u=(0,r.keyBy)("id")(t[0]),o=(0,r.keyBy)("id")(t[1]),i=(0,r.flatMap)(function(e){var t=e.infusions,n=void 0===t?[]:t,i=e.upgrades,a=void 0===i?[]:i,s=e.skin,d=void 0===s?null:s,c=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["infusions","upgrades","skin"]);return(0,r.assign)(c,{data:u[c.id],infusions:n.map(function(e){return u[e]}),upgrades:a.map(function(e){return u[e]}),skin:o[d]})})(e);n({equipment:(0,r.keyBy)("slot")(i)})})},o=function(e){return new Promise(function(t){return t({guild:e})})},i=function(e,t){return new Promise(function(n){var u=(0,r.keyBy)("id")(t);n({specializations:(0,r.mapValues)((0,r.map)(function(e){return e?(0,r.assign)(e,{data:u[e.id]}):null}))(e)})})}},function(e,t){e.exports=require("dotenv")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(0)),u=d(n(3)),o=n(2),i=d(n(1)),a=n(5),s=n(10);function d(e){return e&&e.__esModule?e:{default:e}}function c(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var f=r.default.Router();f.get("/",function(e,t){u.default.get(i.default.gwHost+"/characters").headers({Authorization:"Bearer "+e.apiKey}).end(function(e){return e.ok?t.send({body:e.body,statusCode:e.statusCode}):t.status(e.statusCode).send(e.body)})}).get("/:id",function(e,t){u.default.get(i.default.gwHost+"/characters"+e.url).headers({Authorization:"Bearer "+e.apiKey}).end(function(e){if(!e.ok)return t.status(e.statusCode).send(e.body);var n=(0,o.flatMap)(function(e){var t=e.id,n=e.infusions,r=void 0===n?[]:n,u=e.upgrades,o=void 0===u?[]:u;return[t].concat(c(r),c(o))})(e.body.equipment),r=(0,o.map)((0,o.get)("skin"))(e.body.equipment),u=(0,o.flatMap)((0,o.map)((0,o.get)("id")))(e.body.specializations);return Promise.all([(0,a.getItems)(n),(0,a.getSkins)(r),(0,a.getGuild)(e.body.guild),(0,a.getSpecializations)(u)]).then((0,s.parseData)(e.body)).then(function(n){return t.send({body:n,statusCode:e.statusCode})})})}),t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(0)),u=d(n(12)),o=d(n(9)),i=d(n(8)),a=d(n(7)),s=n(5);function d(e){return e&&e.__esModule?e:{default:e}}var c=r.default.Router();c.use(function(e,t,n){t.set("Cache-Control","no-store, must-revalidate, no-cache"),t.set("Pragma","no-cache"),t.set("Access-Control-Allow-Origin","*"),t.set("Access-Control-Allow-Methods","GET, POST"),n()}).use(s.checkToken).use("/tokeninfo",o.default).use(s.getApiKey).use("/characters",u.default).use("/permissions",i.default).use("/account/wallet",a.default),t.default=c},function(e,t){e.exports=require("body-parser")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(0)),u=s(n(14)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(4)),i=s(n(13)),a=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}var d=(0,r.default)();t.default=function(){o.initializeApp({credential:o.credential.cert(a.default.firebaseCredentials),databaseURL:"https://gw2tracker-7d853.firebaseio.com/"}),d.use(u.default.urlencoded({extended:!1})),d.use(u.default.json()),d.use("/api",i.default),d.listen(a.default.port,function(){console.log("Express router listening on port: "+a.default.port)})}},function(e,t,n){"use strict";(0,function(e){return e&&e.__esModule?e:{default:e}}(n(15)).default)()},function(e,t,n){e.exports=n(16)}]);